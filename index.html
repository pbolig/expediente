<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expedientes</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/choices.min.css"/>
</head>
<body>

    <header>
        <h1>Expedientes</h1>
        <button id="btn-home" class="btn-header" title="Ir al Inicio">üè†</button>
    </header>

    <main>
        <section id="registro-expediente" style="display: none;">
            <h2>Registrar Nuevo Expediente</h2>
            <form id="formulario-expediente">
                <div class="campo-form">
                    <label for="tipo-tramite">Tipo de Tr√°mite:</label>
                    <select id="tipo-tramite"></select>
                </div>
                <div class="campo-form">
                    <div class="campo-con-icono">
                        <label for="descripcion">Descripci√≥n:</label>
                        <button type="button" id="btn-reconocimiento-voz" class="btn-microfono" title="Convertir voz a texto">üé§</button>
                    </div>
                    <textarea id="descripcion" rows="5" placeholder="Descripci√≥n detallada... o presiona el üé§ para dictar" required></textarea>
                </div>
                <div class="campo-form">
                    <label>Documentaci√≥n:</label>
                    <div id="fotos-container">
                        <button type="button" id="btn-tomar-foto" class="btn btn-outline">Adjuntar Archivo</button>
                        <input type="file" id="input-foto" multiple style="display: none;">
                    </div>
                    <div id="fotos-previsualizacion"></div>
                </div>
                <div class="form-actions">
                     <button type="submit" id="btn-guardar" class="btn btn-primary">Guardar Expediente</button>
                </div>
            </form>
        </section>

        <section id="panel-consulta">
            <div class="panel-header">
                <h2>Panel de Consulta</h2>
                <button id="btn-mostrar-formulario" class="btn btn-primary">‚ûï Crear Nuevo Expediente</button>
            </div>
            <form id="formulario-busqueda" class="form-busqueda-mejorado">
                <div class="campo-form">
                    <label for="campo-busqueda">Buscar por texto:</label>
                    <input type="text" id="campo-busqueda" placeholder="Nro. Expediente, descripci√≥n...">
                </div>
                <div class="campo-form">
                    <label for="filtro-estado">Filtrar por Estado:</label>
                    <select id="filtro-estado"></select>
                </div>
                <div class="campo-form">
                    <label for="filtro-tipo-tramite">Filtrar por Tipo:</label>
                    <select id="filtro-tipo-tramite"></select>
                </div>
                <button type="submit" class="btn btn-primary">Buscar</button>
            </form>
            <div id="resultados-busqueda"></div>
            <div id="paginacion-busqueda" class="paginacion"></div>
        </section>

        <section id="panel-edicion" style="display: none;">
            <div class="panel-header">
                <h2>Detalles del Expediente</h2>
                <button id="btn-volver-busqueda" class="btn btn-secondary">‚Üê Volver</button>
            </div>
            <div id="info-expediente-general"></div>
            <h3>Historial de Acontecimientos</h3>
            <div id="grilla-acontecimientos"></div>
            <hr>
            <div class="accordion">
                <h3 class="accordion-header">
                    Agregar Nuevo Acontecimiento
                    <span class="accordion-icon">+</span>
                </h3>
                <div class="accordion-content">
                    <form id="formulario-edicion">
                        <input type="hidden" id="expediente-id-edicion">
                        <div class="campo-form"><label for="descripcion-edicion">Agregar descripci√≥n:</label><textarea id="descripcion-edicion" name="descripcionAcontecimiento" rows="3" placeholder="Descripci√≥n de lo realizado" required></textarea></div>
                        <div class="campo-form"><label>Documentaci√≥n Adicional:</label><div id="fotos-container-edicion"><button type="button" id="btn-adjuntar-edicion" class="btn btn-outline">Adjuntar Archivo</button><input type="file" id="input-foto-edicion" multiple style="display: none;"></div><div id="fotos-previsualizacion-edicion"></div></div>
                        <div class="campo-form"><label>Cambiar Estado:</label><div class="toggle-group"><div class="toggle-option"><input type="radio" id="toggle-espera" name="estado-toggle" value="en-espera" checked><label for="toggle-espera">En Espera</label></div><div class="toggle-option"><input type="radio" id="toggle-iniciado" name="estado-toggle" value="iniciado"><label for="toggle-iniciado">Iniciado</label></div><div class="toggle-option"><input type="radio" id="toggle-finalizado" name="estado-toggle" value="finalizado"><label for="toggle-finalizado">Finalizado</label></div></div></div>
                        <div class="form-actions"><button type="submit" class="btn btn-primary">Guardar Cambios</button><button type="button" id="btn-cancelar-edicion" class="btn btn-secondary">Cancelar</button></div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>¬© 2025 Expedientes ISET57 | <span>V 20251001</span></p>
    </footer>

    <div id="modal-fotos" class="modal">
        <div class="modal-content"><span class="close-btn">&times;</span><h2>Fotos / Archivos</h2><div id="fotos-modal-body"></div></div>
    </div>
    <div id="modal-edicion" class="modal">
        <div class="modal-content"><span class="close-btn-edicion close-btn">&times;</span><h2>Editar Descripci√≥n</h2><form id="form-modal-edicion"><input type="hidden" id="acontecimiento-id-modal"><textarea id="descripcion-modal" rows="6" required></textarea><div class="form-actions"><button type="button" id="btn-cancelar-modal" class="btn btn-secondary">Cancelar</button><button type="submit" class="btn btn-primary">Guardar Cambios</button></div></form></div>
    </div>

    <script src="js/choices.min.js"></script>
    <script src="js/image-compression.js"></script>
    <script src="js/app.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/js/service-worker.js')
                    .then(reg => console.log('Service Worker registrado', reg))
                    .catch(err => console.error('Error al registrar Service Worker:', err));
            });
        }
    </script>
</body>
</html>